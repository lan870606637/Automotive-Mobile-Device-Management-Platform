{% extends "pc/base_pc.html" %}

{% block title %}æˆ‘çš„å€Ÿç”¨è®°å½• - è®¾å¤‡ç®¡ç†ç³»ç»Ÿ{% endblock %}

{% set active_nav = 'records' %}

{% block content %}
<h1 class="page-title">ğŸ“‹ æˆ‘çš„å€Ÿç”¨è®°å½•</h1>

<!-- ç»Ÿè®¡å¡ç‰‡ -->
<div class="stats-grid" style="grid-template-columns: repeat(3, 1fr);">
    <div class="stat-card">
        <div class="stat-header">
            <span class="stat-icon blue">ğŸ“Š</span>
            <span class="stat-label">æ€»è®°å½•</span>
        </div>
        <div class="stat-value">{{ total_records }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-header">
            <span class="stat-icon orange">ğŸ“¤</span>
            <span class="stat-label">å€Ÿç”¨æ¬¡æ•°</span>
        </div>
        <div class="stat-value">{{ borrow_count }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-header">
            <span class="stat-icon green">âœ…</span>
            <span class="stat-label">å½’è¿˜æ¬¡æ•°</span>
        </div>
        <div class="stat-value">{{ return_count }}</div>
    </div>
</div>

<!-- è®°å½•åˆ—è¡¨ -->
<div class="card">
    <div class="card-header">
        <span class="card-title">ğŸ“‹ è®°å½•æ˜ç»†</span>
    </div>
    <div class="card-body">
        {% if records %}
        <table class="data-table">
            <thead>
                <tr>
                    <th>æ—¶é—´</th>
                    <th>è®¾å¤‡åç§°</th>
                    <th>ç±»å‹</th>
                    <th>æ“ä½œ</th>
                    <th>å€Ÿç”¨äºº</th>
                    <th>åŸå› /å¤‡æ³¨</th>
                </tr>
            </thead>
            <tbody>
                {% for record in records %}
                <tr>
                    <td style="font-size: 13px; color: #8c8c8c;">{{ record.operation_time }}</td>
                    <td>
                        <span style="font-size: 16px; margin-right: 4px;">{% if record.device_type == 'è½¦æœº' %}ğŸš—{% else %}ğŸ“±{% endif %}</span>
                        <span style="font-weight: 500;">{{ record.device_name }}</span>
                    </td>
                    <td>{{ record.device_type }}</td>
                    <td>
                        <span class="status-tag
                            {% if 'å€Ÿå‡º' in record.operation_type %}status-borrowed
                            {% elif 'å½’è¿˜' in record.operation_type %}status-available
                            {% elif 'ä¸¢å¤±' in record.operation_type or 'æŸå' in record.operation_type or 'æœªæ‰¾åˆ°' in record.operation_type %}status-lost
                            {% elif 'ç»­æœŸ' in record.operation_type %}status-no-cabinet
                            {% else %}status-borrowed{% endif %}">
                            {{ record.operation_type }}
                        </span>
                    </td>
                    <td>{{ record.borrower }}</td>
                    <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                        {% if record.reason and record.reason != 'nan' %}
                        <button class="btn btn-sm" style="padding: 2px 8px; font-size: 12px;" onclick="showReasonTooltip(this, '{{ record.reason|replace("'", "\\'") }}')" title="æŸ¥çœ‹è¯¦æƒ…">æŸ¥çœ‹åŸå› </button>
                        {% else %}
                        -
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">ğŸ“‹</div>
            <p class="empty-title">æš‚æ— å€Ÿç”¨è®°å½•</p>
            <a href="{{ url_for('pc_device_list') }}" class="btn btn-primary">å»å€Ÿè®¾å¤‡</a>
        </div>
        {% endif %}
    </div>
</div>

<!-- åŸå› æç¤ºæ°”æ³¡ -->
<div id="reasonTooltip" style="position: fixed; background: #333; color: #fff; padding: 12px 16px; border-radius: 8px; font-size: 13px; max-width: 280px; z-index: 3000; display: none; box-shadow: 0 4px 12px rgba(0,0,0,0.15);"></div>

<script>
function showReasonTooltip(btn, reason) {
    const tooltip = document.getElementById('reasonTooltip');
    if (!tooltip) return;
    tooltip.textContent = reason;
    const rect = btn.getBoundingClientRect();
    tooltip.style.left = rect.left + 'px';
    tooltip.style.top = (rect.bottom + 8) + 'px';
    tooltip.style.display = 'block';
    setTimeout(() => {
        document.addEventListener('click', function hide() {
            tooltip.style.display = 'none';
            document.removeEventListener('click', hide);
        });
    }, 100);
}
</script>
{% endblock %}
