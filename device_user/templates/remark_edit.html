{% extends "base.html" %}

{% block title %}ç¼–è¾‘å¤‡æ³¨{% endblock %}

{% set show_nav = false %}

{% block content %}
<div class="form-page">
    <!-- é¡µé¢å¤´éƒ¨ -->
    <div class="page-header">
        <a href="javascript:history.back()" class="back-btn">â€¹</a>
        <h1>ç¼–è¾‘å¤‡æ³¨</h1>
    </div>
    
    <!-- è®¾å¤‡ä¿¡æ¯ -->
    <div class="info-card">
        <div class="device-mini">
            <span class="mini-icon">ğŸ“</span>
            <div class="mini-info">
                <span class="mini-name">ç¼–è¾‘æˆ‘çš„å¤‡æ³¨</span>
                <span class="mini-type">åˆ›å»ºäº {{ remark.create_time.strftime('%Y-%m-%d') }}</span>
            </div>
        </div>
    </div>
    
    <!-- å¤‡æ³¨è¡¨å• -->
    <div class="form-card">
        <h3 class="form-title">ä¿®æ”¹å¤‡æ³¨å†…å®¹</h3>
        
        <div class="form-group">
            <label class="form-label">åŸå†…å®¹</label>
            <div class="original-content">{{ remark.content }}</div>
        </div>
        
        <div class="form-group">
            <label class="form-label">æ–°å†…å®¹</label>
            <textarea id="remarkContent" class="form-textarea" rows="5">{{ remark.content }}</textarea>
        </div>
        
        <div class="form-group">
            <label class="form-label">å¿«æ·å¤‡æ³¨</label>
            <div class="quick-tags">
                <span class="tag" onclick="appendRemark('å±å¹•å®Œå¥½')">å±å¹•å®Œå¥½</span>
                <span class="tag" onclick="appendRemark('ç”µæ± æ­£å¸¸')">ç”µæ± æ­£å¸¸</span>
                <span class="tag" onclick="appendRemark('å……ç”µæ­£å¸¸')">å……ç”µæ­£å¸¸</span>
                <span class="tag" onclick="appendRemark('å¤–è§‚æœ‰åˆ’ç—•')">å¤–è§‚æœ‰åˆ’ç—•</span>
                <span class="tag" onclick="appendRemark('è¿è¡Œæµç•…')">è¿è¡Œæµç•…</span>
                <span class="tag" onclick="appendRemark('éœ€è¦ç»´ä¿®')">éœ€è¦ç»´ä¿®</span>
            </div>
        </div>
    </div>
    
    <!-- æäº¤æŒ‰é’® -->
    <div class="form-actions">
        <button type="button" class="btn btn-default btn-large" onclick="history.back()">å–æ¶ˆ</button>
        <button type="button" class="btn btn-primary btn-large" onclick="updateRemark()">æ›´æ–°å¤‡æ³¨</button>
    </div>
</div>

<script>
function appendRemark(text) {
    const textarea = document.getElementById('remarkContent');
    if (textarea.value) {
        textarea.value += 'ï¼Œ' + text;
    } else {
        textarea.value = text;
    }
}

function updateRemark() {
    const content = document.getElementById('remarkContent').value.trim();
    
    if (!content) {
        showToast('å¤‡æ³¨å†…å®¹ä¸èƒ½ä¸ºç©º');
        return;
    }
    
    const btn = document.querySelector('.btn-primary');
    btn.disabled = true;
    btn.textContent = 'æ›´æ–°ä¸­...';
    
    fetch('/api/remark/edit', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            remark_id: '{{ remark.id }}',
            content: content
        })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            showToast('æ›´æ–°æˆåŠŸï¼');
            setTimeout(() => {
                history.back();
            }, 1500);
        } else {
            showToast(data.message || 'æ›´æ–°å¤±è´¥');
            btn.disabled = false;
            btn.textContent = 'æ›´æ–°å¤‡æ³¨';
        }
    })
    .catch(() => {
        showToast('æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•');
        btn.disabled = false;
        btn.textContent = 'æ›´æ–°å¤‡æ³¨';
    });
}
</script>
{% endblock %}
