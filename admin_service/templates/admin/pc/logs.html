<!-- 
  ç”µè„‘ç«¯åå°ç®¡ç† - æ“ä½œæ—¥å¿—é¡µé¢
-->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ“ä½œæ—¥å¿— - è½¦è½½æµ‹è¯•è®¾å¤‡ç®¡ç†ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="/static/admin/admin_pc.css">
</head>
<body class="pc-admin-body">
    <div class="pc-admin-wrapper">
        <!-- ä¾§è¾¹æ  -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <span class="logo">ğŸ”§</span>
                <span class="logo-text">åå°ç®¡ç†</span>
            </div>
            <nav class="sidebar-nav">
                <a href="/admin/pc/dashboard" class="nav-item">
                    <span class="nav-icon">ğŸ“Š</span>
                    <span>ä»ªè¡¨ç›˜</span>
                </a>
                <a href="/admin/pc/devices" class="nav-item">
                    <span class="nav-icon">ğŸ“±</span>
                    <span>è®¾å¤‡ç®¡ç†</span>
                </a>
                <a href="/admin/pc/users" class="nav-item">
                    <span class="nav-icon">ğŸ‘¥</span>
                    <span>ç”¨æˆ·ç®¡ç†</span>
                </a>
                <a href="/admin/pc/records" class="nav-item">
                    <span class="nav-icon">ğŸ“‹</span>
                    <span>è®°å½•æŸ¥è¯¢</span>
                </a>
                <a href="/admin/pc/logs" class="nav-item active">
                    <span class="nav-icon">ğŸ“œ</span>
                    <span>æ“ä½œæ—¥å¿—</span>
                </a>
                <a href="/admin/pc/overdue" class="nav-item">
                    <span class="nav-icon">âš ï¸</span>
                    <span>è¿‡æœŸæœªè¿˜</span>
                    {% if overdue_count > 0 %}
                    <span class="nav-badge">{{ overdue_count }}</span>
                    {% endif %}
                </a>
            </nav>
            <div class="sidebar-footer">
                <span>ğŸ‘¤ {{ admin_name }}</span>
                <a href="/admin/logout" class="logout-btn">é€€å‡º</a>
            </div>
        </aside>

        <!-- ä¸»å†…å®¹åŒº -->
        <main class="main-content">
            <header class="content-header">
                <h1>æ“ä½œæ—¥å¿—</h1>
                <div class="header-actions">
                    <button class="btn btn-secondary" onclick="refreshLogs()">ğŸ”„ åˆ·æ–°</button>
                </div>
            </header>

            <!-- è¯´æ˜ -->
            <div class="content-card" style="margin-bottom: 20px;">
                <p style="color: #666; font-size: 14px;">ğŸ“‹ æ˜¾ç¤ºæœ€è¿‘100æ¡ç®¡ç†å‘˜æ“ä½œè®°å½•ï¼ŒåŒ…æ‹¬è®¾å¤‡æ“ä½œã€ç”¨æˆ·ç®¡ç†ã€ç³»ç»Ÿè®¾ç½®ç­‰ã€‚</p>
            </div>

            <!-- æ—¥å¿—åˆ—è¡¨ -->
            <div class="data-table">
                <table>
                    <thead>
                        <tr>
                            <th>æ—¶é—´</th>
                            <th>ç®¡ç†å‘˜</th>
                            <th>æ“ä½œç±»å‹</th>
                            <th>æ“ä½œè¯¦æƒ…</th>
                            <th>IPåœ°å€</th>
                        </tr>
                    </thead>
                    <tbody id="logsTableBody">
                        {% for log in logs %}
                        <tr>
                            <td>{{ log.time }}</td>
                            <td>{{ log.admin_name }}</td>
                            <td><span class="action-badge action-{{ log.action_type }}">{{ log.action_type }}</span></td>
                            <td>{{ log.details }}</td>
                            <td style="font-family: monospace; color: #999;">{{ log.ip or '-' }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- Toastæç¤º -->
    <div id="toast" class="toast"></div>

    <script>
        // åŠ è½½æ—¥å¿—
        async function loadLogs() {
            try {
                const response = await fetch('/api/logs?limit=100');
                const logs = await response.json();
                renderLogs(logs);
            } catch (error) {
                showToast('åŠ è½½æ—¥å¿—å¤±è´¥', 'error');
            }
        }

        // æ¸²æŸ“æ—¥å¿—
        function renderLogs(logs) {
            const tbody = document.getElementById('logsTableBody');
            
            if (logs.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="empty-cell">æš‚æ— æ—¥å¿—</td></tr>';
                return;
            }

            tbody.innerHTML = logs.map(log => `
                <tr>
                    <td>${log.time}</td>
                    <td>${log.admin_name}</td>
                    <td><span class="action-badge action-${log.action_type}">${log.action_type}</span></td>
                    <td>${log.details}</td>
                    <td style="font-family: monospace; color: #999;">${log.ip || '-'}</td>
                </tr>
            `).join('');
        }

        // åˆ·æ–°æ—¥å¿—
        function refreshLogs() {
            loadLogs();
            showToast('å·²åˆ·æ–°', 'success');
        }

        // æ˜¾ç¤ºToast
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', loadLogs);
        
        // æ¯30ç§’è‡ªåŠ¨åˆ·æ–°
        setInterval(loadLogs, 30000);
    </script>
</body>
</html>
