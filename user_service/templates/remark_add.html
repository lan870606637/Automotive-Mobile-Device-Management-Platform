{% extends "base.html" %}

{% block title %}æ·»åŠ å¤‡æ³¨ - {{ device.name }}{% endblock %}

{% set show_nav = false %}

{% block content %}
<div class="form-page">
    <!-- é¡µé¢å¤´éƒ¨ -->
    <div class="page-header">
        <a href="javascript:history.back()" class="back-btn">â€¹</a>
        <h1>æ·»åŠ å¤‡æ³¨</h1>
    </div>
    
    <!-- è®¾å¤‡ä¿¡æ¯ -->
    <div class="info-card">
        <div class="device-mini">
            <span class="mini-icon">{% if device_type == 'è½¦æœº' %}ğŸš—{% elif device_type == 'æ‰‹æœº' %}ğŸ“±{% elif device_type == 'ä»ªè¡¨' %}ğŸ“Š{% elif device_type == 'æ‰‹æœºå¡' %}ğŸ“²{% elif device_type == 'å…¶å®ƒè®¾å¤‡' %}ğŸ”§{% else %}ğŸ“¦{% endif %}</span>
            <div class="mini-info">
                <span class="mini-name">{{ device.name }}</span>
                <span class="mini-type">{{ device_type }}</span>
            </div>
        </div>
    </div>
    
    <!-- å¤‡æ³¨è¡¨å• -->
    <div class="form-card">
        <h3 class="form-title">å¡«å†™å¤‡æ³¨å†…å®¹</h3>
        
        <div class="form-group">
            <label class="form-label">å¤‡æ³¨å†…å®¹</label>
            <textarea id="remarkContent" class="form-textarea" rows="5" placeholder="è¯·è¾“å…¥å¤‡æ³¨å†…å®¹ï¼Œå¦‚è®¾å¤‡çŠ¶æ€ã€ä½¿ç”¨æƒ…å†µç­‰..."></textarea>
            <span class="form-hint">å¤‡æ³¨å†…å®¹å°†å¯¹æ‰€æœ‰ç”¨æˆ·å¯è§</span>
        </div>
        
        <div class="form-group">
            <label class="form-label">å¿«æ·å¤‡æ³¨</label>
            <div class="quick-tags">
                <span class="tag" onclick="setRemark('å±å¹•å®Œå¥½')">å±å¹•å®Œå¥½</span>
                <span class="tag" onclick="setRemark('ç”µæ± æ­£å¸¸')">ç”µæ± æ­£å¸¸</span>
                <span class="tag" onclick="setRemark('å……ç”µæ­£å¸¸')">å……ç”µæ­£å¸¸</span>
                <span class="tag" onclick="setRemark('å¤–è§‚æœ‰åˆ’ç—•')">å¤–è§‚æœ‰åˆ’ç—•</span>
                <span class="tag" onclick="setRemark('è¿è¡Œæµç•…')">è¿è¡Œæµç•…</span>
                <span class="tag" onclick="setRemark('éœ€è¦ç»´ä¿®')">éœ€è¦ç»´ä¿®</span>
            </div>
        </div>
    </div>
    
    <!-- æç¤ºä¿¡æ¯ -->
    <div class="tips-card">
        <h4>ğŸ’¡ æç¤º</h4>
        <p>æ·»åŠ å¤‡æ³¨å¯ä»¥å¸®åŠ©å…¶ä»–ç”¨æˆ·äº†è§£è®¾å¤‡çŠ¶æ€ï¼Œè¯·å¦‚å®å¡«å†™ã€‚</p>
    </div>
    
    <!-- æäº¤æŒ‰é’® -->
    <div class="form-actions">
        <button type="button" class="btn btn-default btn-large" onclick="history.back()">å–æ¶ˆ</button>
        <button type="button" class="btn btn-primary btn-large" onclick="submitRemark()">ä¿å­˜å¤‡æ³¨</button>
    </div>
</div>

<script>
function setRemark(text) {
    const textarea = document.getElementById('remarkContent');
    if (textarea.value) {
        textarea.value += 'ï¼Œ' + text;
    } else {
        textarea.value = text;
    }
}

function submitRemark() {
    const content = document.getElementById('remarkContent').value.trim();
    
    if (!content) {
        showToast('è¯·è¾“å…¥å¤‡æ³¨å†…å®¹');
        return;
    }
    
    const btn = document.querySelector('.btn-primary');
    btn.disabled = true;
    btn.textContent = 'ä¿å­˜ä¸­...';
    
    fetch('/api/remark/add', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            device_id: '{{ device.id }}',
            content: content
        })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            showToast('æ·»åŠ æˆåŠŸï¼');
            setTimeout(() => {
                history.back();
            }, 1500);
        } else {
            showToast(data.message || 'æ·»åŠ å¤±è´¥');
            btn.disabled = false;
            btn.textContent = 'ä¿å­˜å¤‡æ³¨';
        }
    })
    .catch(() => {
        showToast('æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•');
        btn.disabled = false;
        btn.textContent = 'ä¿å­˜å¤‡æ³¨';
    });
}
</script>
{% endblock %}
