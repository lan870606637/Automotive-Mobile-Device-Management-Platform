{% extends "pc/base_pc.html" %}

{% block title %}ä»ªè¡¨ç›˜ - è®¾å¤‡ç®¡ç†ç³»ç»Ÿ{% endblock %}

{% set active_nav = 'dashboard' %}

{% block content %}
<h1 class="page-title">ğŸ“Š ä»ªè¡¨ç›˜</h1>

<!-- ç»Ÿè®¡å¡ç‰‡ -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-header">
            <span class="stat-icon blue">ğŸ“¦</span>
            <span class="stat-label">è®¾å¤‡æ€»æ•°</span>
        </div>
        <div class="stat-value">{{ total_devices }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-header">
            <span class="stat-icon green">âœ…</span>
            <span class="stat-label">åœ¨åº“è®¾å¤‡</span>
        </div>
        <div class="stat-value">{{ available_devices }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-header">
            <span class="stat-icon orange">ğŸ“¤</span>
            <span class="stat-label">å€Ÿå‡ºè®¾å¤‡</span>
        </div>
        <div class="stat-value">{{ borrowed_devices_count }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-header">
            <span class="stat-icon red">âš ï¸</span>
            <span class="stat-label">æˆ‘çš„å€Ÿç”¨</span>
        </div>
        <div class="stat-value">{{ my_borrowed_count }}</div>
    </div>
</div>

<!-- æˆ‘çš„å€Ÿç”¨è®¾å¤‡ -->
<div class="card">
    <div class="card-header">
        <span class="card-title">ğŸ“± æˆ‘çš„å€Ÿç”¨è®¾å¤‡</span>
        <a href="{{ url_for('pc_device_list') }}" class="btn btn-default btn-sm">æŸ¥çœ‹å…¨éƒ¨</a>
    </div>
    <div class="card-body">
        {% if my_borrowed_devices %}
        <table class="data-table">
            <thead>
                <tr>
                    <th>è®¾å¤‡åç§°</th>
                    <th>ç±»å‹</th>
                    <th>å€Ÿç”¨æ—¶é—´</th>
                    <th>é¢„è®¡å½’è¿˜</th>
                    <th>å‰©ä½™æ—¶é—´</th>
                    <th>çŠ¶æ€</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                {% for device in my_borrowed_devices %}
                <tr {% if device.is_overdue and device.status.value not in ['ä¸¢å¤±', 'å·²æŸå'] %}style="background: #fff1f0;"{% endif %}>
                    <td>
                        <span class="device-icon">{% if device.device_type.value == 'è½¦æœº' %}ğŸš—{% else %}ğŸ“±{% endif %}</span>
                        <span class="device-name">{{ device.name }}</span>
                    </td>
                    <td class="device-type">{{ device.device_type.value }}</td>
                    <td>{{ device.borrow_time }}</td>
                    <td>
                        {% if device.status.value == 'ä¸¢å¤±' or device.status.value == 'å·²æŸå' %}
                            -
                        {% elif device.expected_return_date %}
                            {{ device.expected_return_date.strftime('%Y-%m-%d %H:%M') }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td {% if device.is_overdue and device.status.value not in ['ä¸¢å¤±', 'å·²æŸå'] %}style="color: #ff4d4f; font-weight: 500;"{% endif %}>
                        {% if device.status.value == 'ä¸¢å¤±' %}
                            -
                        {% elif device.status.value == 'å·²æŸå' %}
                            -
                        {% elif device.is_overdue %}
                        âš ï¸ é€¾æœŸ {% if device.overdue_hours < 24 %}{{ device.overdue_hours }} å°æ—¶{% else %}{{ device.overdue_days }} å¤©{% endif %}
                        {% else %}
                        {% if device.remaining_hours < 24 %}â° {{ device.remaining_hours }} å°æ—¶{% else %}â° {{ device.remaining_days }} å¤©{% endif %}
                        {% endif %}
                    </td>
                    <td>
                        {% if device.status.value == 'ä¸¢å¤±' %}
                        <span class="status-tag status-lost">ä¸¢å¤±</span>
                        {% elif device.status.value == 'å·²æŸå' %}
                        <span class="status-tag status-damaged">å·²æŸå</span>
                        {% elif device.is_overdue %}
                        <span class="status-tag status-lost">å·²é€¾æœŸ</span>
                        {% else %}
                        <span class="status-tag status-borrowed">å€Ÿç”¨ä¸­</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{{ url_for('pc_device_detail', device_id=device.id) }}" class="btn btn-primary btn-sm">æŸ¥çœ‹è¯¦æƒ…</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">ğŸ“­</div>
            <p class="empty-title">æ‚¨å½“å‰æ²¡æœ‰å€Ÿç”¨è®¾å¤‡</p>
            <a href="{{ url_for('pc_device_list') }}" class="btn btn-primary">å»å€Ÿè®¾å¤‡</a>
        </div>
        {% endif %}
    </div>
</div>

<!-- å¿«æ·å…¥å£ -->
<div class="card">
    <div class="card-header">
        <span class="card-title">âš¡ å¿«æ·æ“ä½œ</span>
    </div>
    <div class="card-body">
        <div style="display: flex; gap: 16px;">
            <a href="{{ url_for('pc_device_list', type='car') }}" class="btn btn-primary btn-lg" style="flex: 1;">
                <span>ğŸš—</span> å€Ÿç”¨è½¦æœº
            </a>
            <a href="{{ url_for('pc_device_list', type='phone') }}" class="btn btn-primary btn-lg" style="flex: 1;">
                <span>ğŸ“±</span> å€Ÿç”¨æ‰‹æœº
            </a>
            <a href="{{ url_for('pc_records') }}" class="btn btn-success btn-lg" style="flex: 1;">
                <span>ğŸ“‹</span> æŸ¥çœ‹è®°å½•
            </a>
        </div>
    </div>
</div>
{% endblock %}
